<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Swin transformer&colon; Hierarchical Vision Transformer using Shifted Windows</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension cnblogs.vscode-cnb */
:root{--highlighted-line-bg:#d1e3c9;--highlighted-line-bg-dark:#264b33}.prismjs-engine pre[class*=language-],.prismjs-engine pre[class*=language-].line-numbers{white-space:normal}.prismjs-engine pre[class*=language-] code,.prismjs-engine pre[class*=language-].line-numbers code{display:block;white-space:pre}.hljs-engine pre[class*=language-],.hljs-engine pre[class*=language-].line-numbers{white-space:normal}.hljs-engine pre[class*=language-] code,.hljs-engine pre[class*=language-].line-numbers code{white-space:pre}.hljs-engine .hljs .hljs-ln-numbers{color:#bfbfbf;padding:0 14px}pre.hljs-lines-highlighted{--spacing-left:14px;--spacing-right:14px}pre.hljs-lines-highlighted :after,pre.hljs-lines-highlighted :before{box-sizing:border-box}pre.hljs-lines-highlighted,pre.hljs-lines-highlighted[class*=language-]{padding-left:0;padding-right:0}pre.hljs-lines-highlighted code.hljs[data-lines-highlight],pre.hljs-lines-highlighted code[data-lines-highlight]{padding-left:var(--spacing-left);padding-right:var(--spacing-right);position:relative}pre.hljs-lines-highlighted code.hljs[data-lines-highlight].hljs-line-numbers,pre.hljs-lines-highlighted code[data-lines-highlight].hljs-line-numbers{padding-left:0}pre.hljs-lines-highlighted code.hljs[data-lines-highlight][data-dark-theme],pre.hljs-lines-highlighted code[data-lines-highlight][data-dark-theme]{--highlighted-line-bg:var(--highlighted-line-bg-dark)}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln{margin:0;width:100%}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tbody,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tbody{width:100%}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr:before,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr:before{content:" ";position:absolute}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr:after,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr:after{content:" ";display:block;margin-right:calc(var(--spacing-right)*-1)}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr.highlighted-line,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr.highlighted-line{background:var(--highlighted-line-bg);position:relative}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr.highlighted-line td.hljs-ln-line.hljs-ln-numbers,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr.highlighted-line td.hljs-ln-line.hljs-ln-numbers{background:var(--highlighted-line-bg)}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr.highlighted-line:before,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr.highlighted-line:before{background:var(--highlighted-line-bg);content:"+";display:inline-block;left:4px;position:absolute;z-index:1}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr.highlighted-line:after,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr.highlighted-line:after{background:var(--highlighted-line-bg)}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr td.hljs-ln-line.hljs-ln-numbers,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr td.hljs-ln-line.hljs-ln-numbers{padding-left:calc(var(--spacing-left) + 4px);padding-right:calc(var(--spacing-left) + 4px);width:1px}pre.hljs-lines-highlighted code.hljs[data-lines-highlight] table.hljs-ln tr td.hljs-ln-line.hljs-ln-code,pre.hljs-lines-highlighted code[data-lines-highlight] table.hljs-ln tr td.hljs-ln-line.hljs-ln-code{width:100%}pre.hljs-lines-highlighted code.hljs[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper,pre.hljs-lines-highlighted code[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper{display:inline-block;min-width:100%}pre.hljs-lines-highlighted code.hljs[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line,pre.hljs-lines-highlighted code[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line{background:var(--highlighted-line-bg);display:inline-block;min-width:100%;position:relative}pre.hljs-lines-highlighted code.hljs[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line:before,pre.hljs-lines-highlighted code[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line:before{background:var(--highlighted-line-bg);bottom:0;content:"+";left:calc(var(--spacing-left)*-1);padding-left:calc((var(--spacing-left) - .5px)/3);position:absolute;top:0;width:var(--spacing-left)}pre.hljs-lines-highlighted code.hljs[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line:after,pre.hljs-lines-highlighted code[data-lines-highlight]:not(.hljs-line-numbers) span.hljs-lines-highlight-wrapper span.highlighted-line:after{background:var(--highlighted-line-bg);bottom:0;content:"";left:calc(var(--spacing-left)*-1);left:auto;padding-left:0;position:absolute;right:calc(var(--spacing-right)*-1);top:0;width:var(--spacing-left)}pre.prismjs-lines-highlighted{--spacing-right:1em}pre.prismjs-lines-highlighted :after,pre.prismjs-lines-highlighted :before{box-sizing:border-box}pre.prismjs-lines-highlighted,pre.prismjs-lines-highlighted.line-numbers,pre.prismjs-lines-highlighted[class*=language-]{padding-left:var(--spacing-left);padding-right:var(--spacing-right)}pre.prismjs-lines-highlighted[class*=language-]:not(.line-numbers){--spacing-left:1em}pre.prismjs-lines-highlighted[class*=language-].line-numbers{--spacing-left:3.8em}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight]{display:inline-block;min-width:100%;position:relative}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight][data-dark-theme]{--highlighted-line-bg:var(--highlighted-line-bg-dark)}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight] span.highlighted-line{background:var(--highlighted-line-bg);display:inline-block;min-width:100%;position:relative}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight] span.highlighted-line:after,pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight] span.highlighted-line:before{background:var(--highlighted-line-bg);content:" ";display:inline-block;position:absolute}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight] span.highlighted-line:before{content:"+";left:calc(var(--spacing-left)*-1);padding-left:4px;width:var(--spacing-left)}pre.prismjs-lines-highlighted code.highlighter-prismjs[data-lines-highlight] span.highlighted-line:after{position:absolute;right:calc(var(--spacing-right)*-1);width:var(--spacing-right)}pre.prismjs-lines-highlighted .line-numbers-rows span{padding-right:0}
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="swin-transformer-hierarchical-vision-transformer-using-shifted-windows">Swin transformer: Hierarchical Vision Transformer using Shifted Windows</h1>
<p><strong>ICCV2021</strong></p>
<h2 id="针对的问题">针对的问题</h2>
<ol>
<li>ViT论文发表证明了transformer可以用于cv任务，当还没有一个通用的骨干网络backbone能够通用语所有的cv任务，本文设计的swin transformer在cv的所有下游mlp任务上获得了成功，能够取代CNN成为CV的通用方法。</li>
<li>目前将transformer用于cv视觉任务仍然具有以下难点：
<ul>
<li>目前CV的输入往往远大于NLP的单词序列，ViT将图片分为多个Patch可以解决分类任务，当CV的一些任务需要像素级别的输出的时候就无法使用Patch方法。CNN对于这种像素级别的输出采用了金字塔或者U-Net等方式来进行多尺度的特征分析，而ViT中并没有进行多尺度的分析。</li>
<li>ViT的模型大小是随着输入的Token序列呈现二次增长，这限制了模型的输入尺寸。</li>
</ul>
</li>
</ol>
<p>针对上述的两个问题，Swin transformer主要提出了一个滑动窗口的机制，来解决多尺度的问题，并将模型的大小随着输入尺寸得到了线性的增长，从而能够很好地解决CV的绝大部分下游任务，成为一个通用的backbone。</p>
<h2 id="related-work">Related Work</h2>
<h3 id="cnn-based">CNN-based</h3>
<p>transformer出来之后，CNN方面采取了主要是两个方向：</p>
<ul>
<li>在局部做self-attention，得到之后的输出做CNN。</li>
<li>使用CNN得到特征图feature map,在特征图上做self-attention</li>
</ul>
<h3 id="transformer-based">Transformer-based</h3>
<p>目前ViT模型对于输入的Token序列长度成二次曲线增长，并且需要更大的数据集来进行训练。DeiT（基于知识蒸馏的模型）证明了transfomer模型在同样的数据集上也能够达到和CNN同样的性能。</p>
<h2 id="method">Method</h2>
<ol>
<li>局部窗口的self-attention，Swin transformer能够生成不同尺度上的特征图，可以供下游的任务来进行推理。</li>
</ol>
<img src="https://img2023.cnblogs.com/blog/3183309/202308/3183309-20230826140717256-1533280834.png" alt="image">
<ol start="2">
<li>Shifted window.在上述经过MSA得到的特征图之后，还有经过一层SMSA，它通过cycle-move然后设计掩码来进行实现，相比于滑动窗口而言能够得到更好的结果。</li>
</ol>
<p><img src="https://img2023.cnblogs.com/blog/3183309/202308/3183309-20230826145542556-815859974.png" alt="shift window"></p>
<p>SMSA的掩码：
<img src="https://img2023.cnblogs.com/blog/3183309/202308/3183309-20230826145854808-1566028020.png" alt="mask"></p>
<ol start="3">
<li>相对位置编码，在进行self-attention的时候，模型无法知道当前处理的是第几个patch，所以加入了一个相对的位置偏置，这个位置偏置对于模型来说很重要，在后面的消融实验表明大概能够上升2%的AP。</li>
</ol>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Attention</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">SoftMax</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup><mi mathvariant="normal">/</mi><msqrt><mi>d</mi></msqrt><mo>+</mo><mi>B</mi><mo stretchy="false">)</mo><mi>V</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">\operatorname{Attention}(Q,K,V)=\operatorname{SoftMax}(QK^T/\sqrt d+B)V,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1822em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">SoftMax</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">d</span></span><span style="top:-2.8922em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1078em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span></span></span></span></p>
<pre><code>如果将相对位置编码换成绝对位置编码，会降低模型的性能。
</code></pre>
<p>总的模型图：</p>
<p><img src="https://img2023.cnblogs.com/blog/3183309/202308/3183309-20230826153112073-1653367438.png" alt="img"></p>
<p>对于每一个Swin Block中的forward过程：</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mi>l</mi></msup><mo>=</mo><mtext>W-MSA </mtext><mrow><mo fence="true">(</mo><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mrow><mi>l</mi><mo>−</mo><mn>1</mn></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>+</mo><msup><mi mathvariant="bold">z</mi><mrow><mi>l</mi><mo>−</mo><mn>1</mn></mrow></msup><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msup><mi mathvariant="bold">z</mi><mi>l</mi></msup><mo>=</mo><mtext>М</mtext><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">P</mi></mrow><mrow><mo fence="true">(</mo><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo fence="true">(</mo><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mi>l</mi></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>+</mo><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mi>l</mi></msup><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mtext>SW-MSA</mtext><mrow><mo fence="true">(</mo><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo fence="true">(</mo><msup><mi mathvariant="bold">z</mi><mi>l</mi></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>+</mo><msup><mi mathvariant="bold">z</mi><mi>l</mi></msup><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msup><mi mathvariant="bold">z</mi><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mtext>МLР</mtext><mrow><mo fence="true">(</mo><mtext>LN</mtext><mrow><mo fence="true">(</mo><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>+</mo><msup><mover accent="true"><mi mathvariant="bold">z</mi><mo>^</mo></mover><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow></msup><mo separator="true">,</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
&amp;\hat{\mathbf{z}}^l=\text{W-MSA }\left(\mathrm{LN}\left(\mathbf{z}^{l-1}\right)\right)+\mathbf{z}^{l-1}, \\
&amp;\mathbf{z}^l=\text{М}\mathrm{LP}\left(\mathrm{LN}\left(\hat{\mathbf{z}}^l\right)\right)+\hat{\mathbf{z}}^l, \\
&amp;\hat{\mathbf{z}}^{l+1}=\text{SW-MSA}\left(\mathrm{LN}\left(\mathbf{z}^l\right)\right)+\mathbf{z}^l, \\
&amp;\mathbf{z}^{l+1}=\text{МLР}\left(\text{LN}\left(\hat{\mathbf{z}}^{l+1}\right)\right)+\hat{\mathbf{z}}^{l+1},
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.2364em;vertical-align:-2.8682em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3682em;"><span style="top:-5.3682em;"><span class="pstrut" style="height:2.8991em;"></span><span class="mord"></span></span><span style="top:-3.8091em;"><span class="pstrut" style="height:2.8991em;"></span><span class="mord"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.8991em;"></span><span class="mord"></span></span><span style="top:-0.6909em;"><span class="pstrut" style="height:2.8991em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8682em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3682em;"><span style="top:-5.4691em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">W-MSA </span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathrm">LN</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord cyrillic_fallback">М</span></span><span class="mord"><span class="mord mathrm">LP</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathrm">LN</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mpunct">,</span></span></span><span style="top:-2.3509em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">SW-MSA</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathrm">LN</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mpunct">,</span></span></span><span style="top:-0.7918em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord cyrillic_fallback">М</span><span class="mord">L</span><span class="mord cyrillic_fallback">Р</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord text"><span class="mord">LN</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbf">z</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.8682em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        <script async type="text/javascript">
/* From extension cnblogs.vscode-cnb */
(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var t,n=function(e){for(var t,n=0,r=null!==(t=Array.from(e.classList).filter((function(e){return e.toLowerCase().endsWith("sql")})))&&void 0!==t?t:[];n<r.length;n++){var i=r[n];e.classList.remove(i),e.classList.add("language-sql")}},r=function(e,t){null==t||t.forEach((function(t){return e.setAttribute(t.name,t.value)}))},i={enableCodeLineNumber:!0,prism:{scriptPath:"/prism.min.js",autoLoaderPluginPath:"",lineNumberPluginPath:"",stylesheets:[],themeBaseUrl:"",defaultTheme:""},hljs:{scriptPath:"/highlight.min.js",lineNumberPluginPath:"/highlightjs-line-numbers.min.js",stylesheets:[],themeBaseUrl:"",defaultTheme:""}},o={enableCodeLineNumber:!1,prism:{scriptPath:"https://common.cnblogs.com/prism/prism.js?v=1.23.0",lineNumberPluginPath:"https://common.cnblogs.com/prism/plugins/line-numbers/prism-line-numbers.min.js",autoLoaderPluginPath:"https://common.cnblogs.com/prism/plugins/autoloader/prism-autoloader.min.js",lineNumberStylePath:"https://common.cnblogs.com/prism/plugins/line-numbers/prism-line-numbers.css",themeBaseUrl:"https://www.cnblogs.com/css/prismjs",defaultTheme:"prism-vs",stylesheets:[]},hljs:{scriptPath:"https://common.cnblogs.com/highlight/11.4.0/highlight.min.js",lineNumberPluginPath:"https://common.cnblogs.com/scripts/highlightjs-line-numbers.min.js",stylesheets:[],themeBaseUrl:"https://www.cnblogs.com/css/hljs",defaultTheme:"cnblogs"}};!function(e){var t=Object.assign({},i);e.set=function(e){Object.assign(t,e)},e.get=function(){return t}}(t||(t={}));var s,l=[],a=function(e){e&&clearTimeout(e)},u=function(e,t){var n=l.findIndex((function(n){return e&&n[0]===e||n[0]===t}));n>=0&&l.splice(n,1)},c=function(e){var t,n,r=e.url,i=e.id,o=e.timeoutSeconds,s=e.appendTo,c=e.hostElementTagName,h=e.beforeElementCreateCallback,f=s?s.ownerDocument:document,p=null!==(n=null!==(t=f.defaultView)&&void 0!==t?t:f.parentWindow)&&void 0!==n?n:window,d=function(e,t){var n=l.find((function(n){return e&&n[0]===e||n[0]===t}));return(null!=n?n:[])[1]}(f!==document?"load-resource-to-another-window-context-"+p.name+"-"+i:i,r);if(d)return d;var m=f.querySelector("".concat(c,"#").concat(i));return(m=(m=m||"script"===c&&f.querySelector('script[src="'.concat(r,'"]')))||"link"===c&&f.querySelector('link[href="'.concat(r,'"]')))?Promise.resolve(m):(d=new Promise((function(e,t){var n,l;n=c,l=function(n){var l;n.id=null!=i?i:"",null!=s||(s=f.head),o=o<=0?5:o,n instanceof HTMLLinkElement?(n.href=r,n.rel="stylesheet",n.type="text/css"):n instanceof HTMLScriptElement&&(n.src=r,n.type="text/javascript",n.defer=!0),n.onload=function(){a(l),u(i,r),e(n)},n.onerror=function(e){a(l),n.remove(),u(i,r),t(e)},null==h||h.call(void 0,n),s.append(n),l=setTimeout((function(){a(l),n.remove(),u(i,r),t("timeout after ".concat(o," seconds"))}),1e3*o)},l(document.createElement(n))})),l.push([i||r,d]),d)},h={},f=function(){return h},p=function(e){var t,n=e.src,r=e.id,i=e.timeoutSeconds,o=e.appendTo,s=e.executionStrategy;return c({url:n,hostElementTagName:"script",timeoutSeconds:null!==(t=null!=i?i:f().timeoutSeconds)&&void 0!==t?t:5,id:r,appendTo:null!=o?o:f().appendTo,beforeElementCreateCallback:function(e){e instanceof HTMLScriptElement&&("async"===(null!=s?s:f().executionStrategy)?(e.async=!0,e.defer=!1):(e.defer=!0,e.async=!1))}})},d=function(e){var t,n=e.href,r=e.timeoutSeconds,i=e.id,o=e.appendTo;return c({url:n,hostElementTagName:"link",timeoutSeconds:null!==(t=null!=r?r:f().timeoutSeconds)&&void 0!==t?t:5,id:i,appendTo:null!=o?o:f().appendTo})},m="highlighted-line",g="highlighter-prismjs",b=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function l(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((r=r.apply(e,t||[])).next())}))},y=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},v=function(){function e(){this._isDarkTheme=!1,this.removeLinkElements("link[rel=stylesheet][prismjs]"),this.removeLinkElements("link[rel=stylesheet][hljs]")}return Object.defineProperty(e.prototype,"enableCodeLineNumber",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adapterOptions",{get:function(){return t.get()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDarkTheme",{get:function(){return this._isDarkTheme},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linesHighlightedClassToken",{get:function(){return this.id+"-lines-highlighted"},enumerable:!1,configurable:!0}),e.prototype.highlightAllUnder=function(e,t,n){return b(this,void 0,void 0,(function(){var r,i,o,s,l,a,u,c=this;return y(this,(function(h){switch(h.label){case 0:return(r="string"==typeof e?document.querySelector(e):e)?(i=Array.from(r.querySelectorAll("pre code")).map((function(e){return e}))).length>0?[4,this.ensureResourcesLoaded()]:[3,2]:[2];case 1:h.sent(),h.label=2;case 2:for(o=[],s=function(e){var r=e.parentElement,i=e;if(t&&!t(r,i))return"continue";o.push(new Promise((function(e,t){c.highlight(i).then((function(){n&&n(r,i),e()}),(function(){return t()}))})))},l=0,a=i;l<a.length;l++)u=a[l],s(u);return[4,Promise.all(o)];case 3:return h.sent(),[2]}}))}))},e.prototype.setTheme=function(e,t,n){var i;return b(this,void 0,void 0,(function(){var o,s;return y(this,(function(l){switch(l.label){case 0:if(this.setIsDarkTheme(n),!e&&!this.highlighterOptions.defaultTheme)throw Error("Theme is required! And default theme not configured!");return e||(e=this.highlighterOptions.defaultTheme),o="highlighter-theme-".concat(e),s=!1,null===(i=document.querySelectorAll("link[id*=highlighter-theme-],link[id*=line-numbers-style]"))||void 0===i||i.forEach((function(e){e.id!==o?e.remove():s=!0})),s?[2]:(this._themeHref="".concat(this.highlighterOptions.themeBaseUrl,"/").concat(e,".css"),[4,d({href:this._themeHref,id:o,beforeElementCreateCallback:function(e){return r(e,t)}})]);case 1:return l.sent(),[2]}}))}))},e.prototype.resolveContainerElements=function(e){var t=null,n=null;if(e instanceof HTMLPreElement?(t=e,n=e.querySelector("code")):"code"===e.tagName.toLowerCase()&&e.parentElement instanceof HTMLPreElement&&(t=e.parentElement,n=e),n&&t)return[t,n]},e.prototype.loadStyles=function(e){var t;return b(this,void 0,void 0,(function(){var n,i,o,s,l;return y(this,(function(a){switch(a.label){case 0:for(n=null!==(t=this.highlighterOptions.stylesheets)&&void 0!==t?t:[],i=[],o=0,s=n;o<s.length;o++)l=s[o],i.push(d({href:l.href,id:l.tagId,beforeElementCreateCallback:function(t){return r(t,e)}}));return[4,Promise.all(i)];case 1:return a.sent(),[2]}}))}))},e.prototype.tryApplyLang=function(e){var t,n,r,i,o,s;if(!e)return"";var l=Array.from(e.classList),a=null!==(r=null===(n=null===(t=e.parentElement)||void 0===t?void 0:t.tagName)||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:"";if(l.findIndex((function(e){return e.startsWith("language-")}))<0&&"pre"===a){var u=Array.from(null!==(o=null===(i=e.parentElement)||void 0===i?void 0:i.classList)&&void 0!==o?o:[]).find((function(e){return e.startsWith("language-")}));u&&e.classList.add(u)}return null!==(s=Array.from(e.classList).find((function(e){return e.startsWith("language-")})))&&void 0!==s?s:""},e.prototype.setBodyClass=function(e){var t=["prismjs-engine","hljs-engine"],n=window.document.body.classList;switch(n.remove.apply(n,t),e){case"prismjs":n.add(t[0]);break;case"highlight.js":n.add(t[1])}},e.prototype.setEngineClassToken=function(e,t){for(var n=[g,"highlighter-hljs"],r=t.querySelector("code"),i=0,o=[null==r?void 0:r.classList,t.classList];i<o.length;i++){var s=o[i];switch(null==s||s.remove.apply(s,n),e){case"prismjs":null==s||s.add(n[0]);break;case"highlight.js":null==s||s.add(n[1])}}},e.prototype.removeLinesHighlightedClassToken=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var i=r[n].classList;i.remove.apply(i,Array.from(i).filter((function(e){return e.endsWith("-lines-highlighted")})))}},e.prototype.filterCodeContent=function(e){var t,n;if(!e)return"";var r=document.createElement("code");if(r.style.opacity="0",r.style.width="0",r.style.height="0",r.style.whiteSpace="pre","code"===e.tagName.toLowerCase())r.innerHTML=e.innerHTML;else{if("pre"!==e.tagName.toLowerCase()||!e.querySelector("code"))return"";r.innerHTML=null!==(n=null===(t=e.querySelector("code"))||void 0===t?void 0:t.innerHTML)&&void 0!==n?n:""}var i=r.querySelector(".line-numbers-rows");i&&i.remove();var o=r.querySelectorAll(".hljs-ln-line.hljs-ln-numbers");null==o||o.forEach((function(e){return e.remove()})),document.body.append(r);var s,l,a=r.innerText;return r.remove(),e.innerHTML=(s=a,(l=document.createElement("div")).textContent=s,l.innerHTML),a},e.prototype.removeLinkElements=function(e){var t;null===(t=document.querySelectorAll(e))||void 0===t||t.forEach((function(e){return e.remove()}))},e.prototype.resolveLinesToHighlight=function(e){var t=e.getAttribute("data-lines-highlight");try{var n=JSON.parse(null!=t?t:"[]");return Array.isArray(n)?n.map((function(e){return e-1})):[]}catch(e){return void console.warn(e)}},e.prototype.setIsDarkTheme=function(e){this._isDarkTheme=null!=e&&e},e}(),w={tcltk:"tcl",tclsh:"tcl",tk:"tcl",pq:"powerquery",mscript:"powerquery",M:"powerquery",wat:"wasm",wast:"wasm",webassembly:"wasm"};!function(e){var t=this,n=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return hljs.getLanguage(e)?(hljs.registerAliases(t.filter((function(e){return null==hljs.getLanguage(e)})),{languageName:e}),!0):(console.warn("Try to register [".concat(t.join(","),"] as aliases of ").concat(e,", but ").concat(e," is not defined.")),!1)};e.load=function(e,r){return i=t,o=void 0,l=function(){var t,i,o,s,l,a;return function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}(this,(function(u){switch(u.label){case 0:if(e=e.toLowerCase().trim().replace("language-",""),!(t=null!==(a=w[e])&&void 0!==a?a:e)||hljs.getLanguage(t))return n(t,e),[2];i=r.scriptPath,(o=i.split("/")).pop(),s=o.join("/")+"/languages/".concat(t,".min.js"),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,p({id:"hljs-language-".concat(t),src:s})];case 2:return u.sent(),n(t,e),[3,4];case 3:return l=u.sent(),console.warn("加载hljs语言定义脚本失败",l),[3,4];case 4:return[2]}}))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{a(l.next(e))}catch(e){t(e)}}function r(e){try{a(l.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,r)}a((l=l.apply(i,o||[])).next())}));var i,o,s,l}}(s||(s={}));var L,j=(L=function(e,t){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},L(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}L(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),P=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function l(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((r=r.apply(e,t||[])).next())}))},T=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},k=window,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._linkAttr={name:"hljs",value:""},t}return j(t,e),Object.defineProperty(t.prototype,"highlighterOptions",{get:function(){return this.adapterOptions.hljs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return"highlight.js"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linesHighlightedClassToken",{get:function(){return"hljs-lines-highlighted"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableCodeLineNumber",{get:function(){return this.adapterOptions.enableCodeLineNumber},enumerable:!1,configurable:!0}),t.prototype.ensureResourcesLoaded=function(){return P(this,void 0,void 0,(function(){var e;return T(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.loadHljs()];case 1:return t.sent(),[4,this.loadStyles([this._linkAttr])];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),console.error(e),[2];case 4:return[2]}}))}))},t.prototype.highlight=function(e){var t;return P(this,void 0,void 0,(function(){var r,i,o,l,a,u;return T(this,(function(c){switch(c.label){case 0:return[4,this.ensureResourcesLoaded()];case 1:if(c.sent(),r=this.enableCodeLineNumber,i=null!==(t=this.resolveContainerElements(e))&&void 0!==t?t:[],o=i[0],l=i[1],!o||!l)return[2];o.classList.remove(g),c.label=2;case 2:return c.trys.push([2,5,,6]),r?[4,this.loadLineNumberPlugin()]:[3,4];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return a=c.sent(),console.error(a),[3,6];case 6:return this.setBodyClass("highlight.js"),this.setEngineClassToken(this.id,o),this.removeLinesHighlightedClassToken(o,l),e.classList.remove("hljs-line-numbers"),u=this.tryApplyLang(e),this.filterCodeContent(e),n(e),[4,s.load(u,this.highlighterOptions)];case 7:return c.sent(),hljs.highlightElement(e),r&&(hljs.lineNumbersValue?(e.innerHTML=hljs.lineNumbersValue(e.innerHTML,{singleLine:!0}),e.classList.add("hljs-line-numbers")):console.error("failed to load hljs line numbers plugin!")),this.highlightLines(o),l.classList.add("hljs"),this.isDarkTheme?e.setAttribute("data-dark-theme","true"):e.removeAttribute("data-dark-theme"),[2]}}))}))},t.prototype.highlightLines=function(e){var t=e.querySelector("code");if(!t)return[];var n=this.resolveLinesToHighlight(t);if(null==n||n.length<=0)return[];var r=t.innerHTML;if(!1===this.adapterOptions.enableCodeLineNumber){for(var i=r.split("\n"),o=0,s=n;o<s.length;o++)if(!((c=s[o])<0||c>=i.length)){var l=i[c];null!=l&&(i[c]='<span class="'.concat(m,'">').concat(l,"</span>"))}t.innerHTML='<span class="hljs-lines-highlight-wrapper">'.concat(i.join("\n"),"</span>")}else{i=Array.from(t.querySelectorAll("tr"));for(var a=0,u=n;a<u.length;a++){var c;if(!((c=u[a])<0||c>=i.length)){var h=i[c];h&&h.classList.add(m)}}}return e.classList.add(this.linesHighlightedClassToken),null!=n?n:[]},t.prototype.loadHljs=function(){return P(this,void 0,void 0,(function(){var e;return T(this,(function(t){switch(t.label){case 0:return e=this.adapterOptions.hljs.scriptPath,k.hljs?[3,2]:[4,p({id:"hljs-script",src:e})];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.loadLineNumberPlugin=function(){return P(this,void 0,void 0,(function(){var e;return T(this,(function(t){switch(t.label){case 0:return e=this.adapterOptions.hljs.lineNumberPluginPath,[4,p({id:"hljs-line-numbers",src:e})];case 1:return t.sent(),[2]}}))}))},t}(v),S=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function l(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}a((r=r.apply(e,t||[])).next())}))},E=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},H=window,N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._linkAttr={name:"prismjs",value:""},t}return S(t,e),Object.defineProperty(t.prototype,"highlighterOptions",{get:function(){return this.adapterOptions.prism},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return"prismjs"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableCodeLineNumber",{get:function(){return this.adapterOptions.enableCodeLineNumber},enumerable:!1,configurable:!0}),t.prototype.highlight=function(e){var t;return O(this,void 0,void 0,(function(){var r,i,o;return E(this,(function(s){switch(s.label){case 0:return[4,this.ensureResourcesLoaded()];case 1:return s.sent(),r=null!==(t=this.resolveContainerElements(e))&&void 0!==t?t:[],i=r[0],o=r[1],i&&o?(this.adapterOptions.enableCodeLineNumber?i.classList.add("line-numbers"):(i.classList.remove("line-numbers"),o.classList.remove("line-numbers")),this.tryApplyLang(o),this.setBodyClass("prismjs"),this.setEngineClassToken(this.id,i),this.removeLinesHighlightedClassToken(i),this.filterCodeContent(o),n(o),Prism.highlightElement(o,!1),this.highlightLines(i),[2]):[2]}}))}))},t.prototype.highlightLines=function(e){var t,n,r=e.querySelector("code"),i=this.resolveLinesToHighlight(r)||this.resolveLinesToHighlight(e);if(!i)return[];var o=r.innerHTML,s=null!==(n=null===(t=r.querySelector(".line-numbers-rows"))||void 0===t?void 0:t.outerHTML)&&void 0!==n?n:"";s&&(o=o.replace(s,""));var l=o.split("\n");return i.forEach((function(e){if(!(e<0||e>=l.length)){var t=l[e];l[e]='<span class="'.concat(m,'">').concat(t,"</span>")}})),r.innerHTML=l.join("\n")+s,e.classList.add(this.linesHighlightedClassToken),i},t.prototype.ensureResourcesLoaded=function(){return O(this,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,this.loadPrismAsync()];case 1:return t.sent(),[4,Promise.all([this.loadPrismAutoLoader(),this.loadPrismLineNumberPluginScript()])];case 2:return t.sent(),[4,this.loadStyles([this._linkAttr])];case 3:return t.sent(),[3,5];case 4:return e=t.sent(),console.error(e),[2];case 5:return[2]}}))}))},t.prototype.setTheme=function(t,n,r){return O(this,void 0,void 0,(function(){return E(this,(function(i){switch(i.label){case 0:return[4,e.prototype.setTheme.call(this,t,n,r)];case 1:return i.sent(),[4,this.loadPrismLineNumberPluginStyle()];case 2:return i.sent(),[2]}}))}))},t.prototype.loadPrismAsync=function(){return O(this,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:return H.Prism=H.Prism||{},Prism.manual=!0,e=this.adapterOptions.prism.scriptPath,[4,p({id:"prismjs-script",src:e})];case 1:return t.sent(),[2]}}))}))},t.prototype.loadPrismAutoLoader=function(){var e;return O(this,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:return t=!!(null===(e=H.Prism.plugins)||void 0===e?void 0:e.autoloader),n=this.adapterOptions.prism.autoLoaderPluginPath,t?[3,2]:[4,p({id:"prismjs-autoloader-script",src:n})];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.loadPrismLineNumberPluginScript=function(){return O(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:if(!this.enableCodeLineNumber)return[2];if(!this.adapterOptions.prism.lineNumberPluginPath)throw Error("lineNumberPluginPath not configured");return[4,p({id:"prism-line-numbers-script",src:this.adapterOptions.prism.lineNumberPluginPath})];case 1:return e.sent(),[2]}}))}))},t.prototype.loadPrismLineNumberPluginStyle=function(){return O(this,void 0,void 0,(function(){return E(this,(function(e){if(!this.enableCodeLineNumber)return[2];if(!this.adapterOptions.prism.lineNumberStylePath)throw Error("lineNumberStylePath not configured");return d({id:"prism-line-numbers-style",href:this.adapterOptions.prism.lineNumberStylePath,beforeElementCreateCallback:function(e){return r(e,[{name:"prismjs",value:""}])}}).then(),[2]}))}))},t}(v);function A(){const e="highlightedLineBackground";if(null===document.querySelector(`#${e}`)){const t=document.createElement("style");t.id=e,t.innerHTML=":root { --highlighted-line-bg: var(--vscode-diffEditor-insertedTextBackground) }",document.head.append(t)}const t=new C;document.querySelectorAll('pre[class*="language-"][data-lines-highlight]').forEach((e=>{const n=e.querySelector("code");null!==n&&(n.firstChild instanceof HTMLDivElement&&1===n.children.length&&(n.firstChild.outerHTML=n.firstChild.innerHTML),t.highlightLines(e))}))}(function(){function e(){}return e.configCodeHighlightOptions=function(e){t.set(e)},e.useCnblogsCodeHighlightOptions=function(){this.configCodeHighlightOptions(o)},e.createCodeHighlighter=function(e,t,n){var r;switch(n&&this.configCodeHighlightOptions(n),e){case"highlight.js":r=new C;break;case"prismjs":r=new N;break;default:throw Error("unknown highlight engine")}t||(t=r.highlighterOptions.defaultTheme);var i="string"==typeof t?t:t.name,o="string"!=typeof t&&t.isDark;return r.setTheme(i,void 0,o).then(),r},e})().configCodeHighlightOptions({enableCodeLineNumber:!1}),window.addEventListener("vscode.markdown.updateContent",A),A(),module.exports=e})();
</script>

    </body>
    </html>